# Values for Unity Catalog OSS
ingress:
  enabled: true
  className: "traefik"
  hosts:
    - host: unity.$(INGRESS_DOMAIN)
      paths:
        - path: /
          pathType: ImplementationSpecific

# S3/MinIO Storage Configuration
unitycatalog-server:
  env:
    # MinIO S3-compatible storage
    - name: AWS_REGION
      value: "us-east-1"
    - name: AWS_ACCESS_KEY_ID
      value: "minioadmin"
    - name: AWS_SECRET_ACCESS_KEY
      value: "minioadmin"
    - name: AWS_S3_ENDPOINT
      value: "http://minio.default.svc.cluster.local:9000"
    - name: AWS_S3_PATH_STYLE_ACCESS
      value: "true"
    
    # Override AWS SDK to use MinIO for STS (critical for credential vending)
    - name: AWS_ENDPOINT_URL_STS
      value: "http://minio.default.svc.cluster.local:9000"
    - name: AWS_ENDPOINT_URL_S3
      value: "http://minio.default.svc.cluster.local:9000"
    
    # Java system properties for AWS SDK endpoint override
    - name: JAVA_OPTS
      value: "-Daws.endpointUrl=http://minio.default.svc.cluster.local:9000 -Daws.stsEndpoint=http://minio.default.svc.cluster.local:9000"

  # Mount server.properties configuration
  volumeMounts:
    - name: server-config
      mountPath: /home/unitycatalog/etc/conf/server.properties
      subPath: server.properties

  volumes:
    - name: server-config
      configMap:
        name: unity-catalog-server-config
